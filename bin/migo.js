// Generated by ToffeeScript 1.6.3-4
(function() {
  var VERSION, conf, data, err, fs, m, migo, opt, p,
    _this = this;

  fs = require('fs');

  migo = require('..');

  VERSION = 0.1;

  opt = require('node-getopt').create([['c', 'conf=FILENAME', 'configure file'], ['h', 'help']]).bindHelp("migo v" + VERSION + " - PostgreSQL Database Migration\n\nUsage:\n  migo.js [OPTION] FILENAME [VERSION]\n\nOptions:\n[[OPTIONS]]\n\nMore help on https://github.com/jiangmiao/migo").parseSystem();

  function ok(e) {
    var _ref;
    if (e) {
      console.log((_ref = e.message) != null ? _ref : e);
      return process.exit(1);
    }
  };

  p = console.log;

  conf = opt.options.conf;

  if (conf == null) {
    conf = 'migo.conf';
  }

  fs.readFile(conf, 'UTF-8', function() {
    err = arguments[0], data = arguments[1];
    ok(err);
    conf = {};
    data.replace(/^(.*?)=(.*)/m, function(_, k, v) {
      k = k.trim();
      v = v.trim();
      return conf[k] = v;
    });
    m = migo.init(conf);
    m.parseFile(opt.argv[0], function() {
      m.migrate(opt.argv[1], function() {
        return migo.close();
      });
    });
  });

}).call(this);
